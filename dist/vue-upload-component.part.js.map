{"version":3,"file":"vue-upload-component.part.js","sources":["../src/utils/request.js","../src/chunk/ChunkUploadHandler.js","../src/InputFile.vue.js?rollup-plugin-vue=script.js","../src/FileUpload.vue.js?rollup-plugin-vue=script.js","../src/index.js"],"sourcesContent":["/**\n * Creates a XHR request\n *\n * @param {Object} options\n */\nexport const createRequest = (options) => {\n  const xhr = new XMLHttpRequest()\n  xhr.open(options.method || 'GET', options.url)\n  xhr.responseType = 'json'\n  if (options.headers) {\n    Object.keys(options.headers).forEach(key => {\n      xhr.setRequestHeader(key, options.headers[key])\n    })\n  }\n\n  return xhr\n}\n\n/**\n * Sends a XHR request with certain body\n *\n * @param {XMLHttpRequest} xhr\n * @param {Object} body\n */\nexport const sendRequest = (xhr, body) => {\n  return new Promise((resolve, reject) => {\n    xhr.onload = () => {\n      if (xhr.status >= 200 && xhr.status < 300) {\n        var response\n        try {\n          response = JSON.parse(xhr.response)\n        } catch (err) {\n          response = xhr.response\n        }\n        resolve(response)\n      } else {\n        reject(xhr.response)\n      }\n    }\n    xhr.onerror = () => reject(xhr.response)\n    xhr.send(JSON.stringify(body))\n  })\n}\n\n/**\n * Sends a XHR request with certain form data\n *\n * @param {XMLHttpRequest} xhr\n * @param {Object} data\n */\nexport const sendFormRequest = (xhr, data) => {\n  const body = new FormData()\n  for (var name in data) {\n    body.append(name, data[name])\n  }\n\n  return new Promise((resolve, reject) => {\n    xhr.onload = () => {\n      if (xhr.status >= 200 && xhr.status < 300) {\n        var response\n        try {\n          response = JSON.parse(xhr.response)\n        } catch (err) {\n          response = xhr.response\n        }\n        resolve(response)\n      } else {\n        reject(xhr.response)\n      }\n    }\n    xhr.onerror = () => reject(xhr.response)\n    xhr.send(body)\n  })\n}\n\n/**\n * Creates and sends XHR request\n *\n * @param {Object} options\n *\n * @returns Promise\n */\nexport default function (options) {\n  const xhr = createRequest(options)\n\n  return sendRequest(xhr, options.body)\n}\n","import {\n  default as request,\n  createRequest,\n  sendFormRequest\n} from '../utils/request'\n\nexport default class ChunkUploadHandler {\n  /**\n   * Constructor\n   *\n   * @param {File} file\n   * @param {Object} options\n   */\n  constructor (file, options) {\n    this.file = file\n    this.options = options\n  }\n\n  /**\n   * Gets the max retries from options\n   */\n  get maxRetries () {\n    return parseInt(this.options.maxRetries)\n  }\n\n  /**\n   * Gets the max number of active chunks being uploaded at once from options\n   */\n  get maxActiveChunks () {\n    return parseInt(this.options.maxActive)\n  }\n\n  /**\n   * Gets the file type\n   */\n  get fileType () {\n    return this.file.type\n  }\n\n  /**\n   * Gets the file size\n   */\n  get fileSize () {\n    return this.file.size\n  }\n\n  /**\n   * Gets the file name\n   */\n  get fileName () {\n    return this.file.name\n  }\n\n  /**\n   * Gets action (url) to upload the file\n   */\n  get action () {\n    return this.options.action || null\n  }\n\n  /**\n   * Gets the body to be merged when sending the request in start phase\n   */\n  get startBody () {\n    return this.options.startBody || {}\n  }\n\n  /**\n   * Gets the body to be merged when sending the request in upload phase\n   */\n  get uploadBody () {\n    return this.options.uploadBody || {}\n  }\n\n  /**\n   * Gets the body to be merged when sending the request in finish phase\n   */\n  get finishBody () {\n    return this.options.finishBody || {}\n  }\n\n  /**\n   * Gets the headers of the requests from options\n   */\n  get headers () {\n    return this.options.headers || {}\n  }\n\n  /**\n   * Whether it's ready to upload files or not\n   */\n  get readyToUpload () {\n    return !!this.chunks\n  }\n\n  /**\n   * Gets the progress of the chunk upload\n   * - Gets all the completed chunks\n   * - Gets the progress of all the chunks that are being uploaded\n   */\n  get progress () {\n    const completedProgress = (this.chunksUploaded.length / this.chunks.length) * 100\n    const uploadingProgress = this.chunksUploading.reduce((progress, chunk) => {\n      return progress + ((chunk.progress | 0) / this.chunks.length)\n    }, 0)\n\n    return Math.min(completedProgress + uploadingProgress, 100)\n  }\n\n  /**\n   * Gets all the chunks that are pending to be uploaded\n   */\n  get chunksToUpload () {\n    return this.chunks.filter(chunk => {\n      return !chunk.active && !chunk.uploaded\n    })\n  }\n\n  /**\n   * Whether there are chunks to upload or not\n   */\n  get hasChunksToUpload () {\n    return this.chunksToUpload.length > 0\n  }\n\n  /**\n   * Gets all the chunks that are uploading\n   */\n  get chunksUploading () {\n    return this.chunks.filter(chunk => {\n      return !!chunk.xhr && !!chunk.active\n    })\n  }\n\n  /**\n   * Gets all the chunks that have finished uploading\n   */\n  get chunksUploaded () {\n    return this.chunks.filter(chunk => {\n      return !!chunk.uploaded\n    })\n  }\n\n  /**\n   * Creates all the chunks in the initial state\n   */\n  createChunks () {\n    this.chunks = []\n\n    let start = 0\n    let end = this.chunkSize\n    while (start < this.fileSize) {\n      this.chunks.push({\n        blob: this.file.file.slice(start, end),\n        startOffset: start,\n        active: false,\n        retries: this.maxRetries\n      })\n      start = end\n      end = start + this.chunkSize\n    }\n  }\n\n  /**\n   * Updates the progress of the file with the handler's progress\n   */\n  updateFileProgress () {\n    this.file.progress = this.progress\n  }\n\n  /**\n   * Paues the upload process\n   * - Stops all active requests\n   * - Sets the file not active\n   */\n  pause () {\n    this.file.active = false\n    this.stopChunks()\n  }\n\n  /**\n   * Stops all the current chunks\n   */\n  stopChunks () {\n    this.chunksUploading.forEach(chunk => {\n      chunk.xhr.abort()\n      chunk.active = false\n    })\n  }\n\n  /**\n   * Resumes the file upload\n   * - Sets the file active\n   * - Starts the following chunks\n   */\n  resume () {\n    this.file.active = true\n    this.startChunking()\n  }\n\n  /**\n   * Starts the file upload\n   *\n   * @returns Promise\n   * - resolve  The file was uploaded\n   * - reject   The file upload failed\n   */\n  upload () {\n    this.promise = new Promise((resolve, reject) => {\n      this.resolve = resolve\n      this.reject = reject\n    })\n    this.start()\n\n    return this.promise\n  }\n\n  /**\n   * Start phase\n   * Sends a request to the backend to initialise the chunks\n   */\n  start () {\n    request({\n      method: 'POST',\n      headers: Object.assign({}, this.headers, {\n        'Content-Type': 'application/json'\n      }),\n      url: this.action,\n      body: Object.assign(this.startBody, {\n        phase: 'start',\n        mime_type: this.fileType,\n        size: this.fileSize,\n        name: this.fileName\n      })\n    }).then(res => {\n      if (res.status !== 'success') {\n        this.file.response = res\n        return this.reject('server')\n      }\n\n      this.sessionId = res.data.session_id\n      this.chunkSize = res.data.end_offset\n\n      this.createChunks()\n      this.startChunking()\n    }).catch(res => {\n      this.file.response = res\n      this.reject('server')\n    })\n  }\n\n  /**\n   * Starts to upload chunks\n   */\n  startChunking () {\n    for (let i = 0; i < this.maxActiveChunks; i++) {\n      this.uploadNextChunk()\n    }\n  }\n\n  /**\n   * Uploads the next chunk\n   * - Won't do anything if the process is paused\n   * - Will start finish phase if there are no more chunks to upload\n   */\n  uploadNextChunk () {\n    if (this.file.active) {\n      if (this.hasChunksToUpload) {\n        return this.uploadChunk(this.chunksToUpload[0])\n      }\n\n      if (this.chunksUploading.length === 0) {\n        return this.finish()\n      }\n    }\n  }\n\n  /**\n   * Uploads a chunk\n   * - Sends the chunk to the backend\n   * - Sets the chunk as uploaded if everything went well\n   * - Decreases the number of retries if anything went wrong\n   * - Fails if there are no more retries\n   *\n   * @param {Object} chunk\n   */\n  uploadChunk (chunk) {\n    chunk.progress = 0\n    chunk.active = true\n    this.updateFileProgress()\n    chunk.xhr = createRequest({\n      method: 'POST',\n      headers: this.headers,\n      url: this.action\n    })\n\n    chunk.xhr.upload.addEventListener('progress', function (evt) {\n      if (evt.lengthComputable) {\n        chunk.progress = Math.round(evt.loaded / evt.total * 100)\n      }\n    }, false)\n\n    sendFormRequest(chunk.xhr, Object.assign(this.uploadBody, {\n      phase: 'upload',\n      session_id: this.sessionId,\n      start_offset: chunk.startOffset,\n      chunk: chunk.blob\n    })).then(res => {\n      chunk.active = false\n      if (res.status === 'success') {\n        chunk.uploaded = true\n      } else {\n        if (chunk.retries-- <= 0) {\n          this.stopChunks()\n          return this.reject('upload')\n        }\n      }\n\n      this.uploadNextChunk()\n    }).catch(() => {\n      chunk.active = false\n      if (chunk.retries-- <= 0) {\n        this.stopChunks()\n        return this.reject('upload')\n      }\n\n      this.uploadNextChunk()\n    })\n  }\n\n  /**\n   * Finish phase\n   * Sends a request to the backend to finish the process\n   */\n  finish () {\n    this.updateFileProgress()\n\n    request({\n      method: 'POST',\n      headers: Object.assign({}, this.headers, {\n        'Content-Type': 'application/json'\n      }),\n      url: this.action,\n      body: Object.assign(this.finishBody, {\n        phase: 'finish',\n        session_id: this.sessionId\n      })\n    }).then(res => {\n      this.file.response = res\n      if (res.status !== 'success') {\n        return this.reject('server')\n      }\n\n      this.resolve(res)\n    }).catch(res => {\n      this.file.response = res\n      this.reject('server')\n    })\n  }\n}\n","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nexport default {\n  methods: {\n    change(e) {\n      this.$parent.addInputFile(e.target)\n      if (e.target.files) {\n        e.target.value = ''\n        if (!/safari/i.test(navigator.userAgent)) {\n          e.target.type = ''\n          e.target.type = 'file'\n        }\n      } else {\n        // ie9 fix #219\n        this.$destroy()\n        // eslint-disable-next-line\n        new this.constructor({\n          parent: this.$parent,\n          el: this.$el,\n        })\n      }\n    }\n  }\n}\n","//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport ChunkUploadDefaultHandler from './chunk/ChunkUploadHandler'\nimport InputFile from './InputFile.vue'\n\nconst CHUNK_DEFAULT_OPTIONS = {\n  headers: {},\n  action: '',\n  minSize: 1048576,\n  maxActive: 3,\n  maxRetries: 5,\n\n  handler: ChunkUploadDefaultHandler\n}\n\nexport default {\n  components: {\n    InputFile,\n  },\n  props: {\n    inputId: {\n      type: String,\n    },\n\n    name: {\n      type: String,\n      default: 'file',\n    },\n\n    accept: {\n      type: String,\n    },\n\n    capture: {\n    },\n\n    disabled: {\n    },\n\n    multiple: {\n      type: Boolean,\n    },\n\n    maximum: {\n      type: Number,\n      default() {\n        return this.multiple ? 0 : 1\n      }\n    },\n\n    addIndex: {\n      type: [Boolean, Number],\n    },\n\n    directory: {\n      type: Boolean,\n    },\n\n    postAction: {\n      type: String,\n    },\n\n    putAction: {\n      type: String,\n    },\n\n    customAction: {\n      type: Function,\n    },\n\n    headers: {\n      type: Object,\n      default: Object,\n    },\n\n    data: {\n      type: Object,\n      default: Object,\n    },\n\n    timeout: {\n      type: Number,\n      default: 0,\n    },\n\n\n    drop: {\n      default: false,\n    },\n\n    dropDirectory: {\n      type: Boolean,\n      default: true,\n    },\n\n    size: {\n      type: [Function, Number],\n      default: 0,\n    },\n\n    extensions: {\n      default: Array,\n    },\n\n\n    value: {\n      type: Array,\n      default: Array,\n    },\n\n    thread: {\n      type: Number,\n      default: 1,\n    },\n\n    // Chunk upload enabled\n    chunkEnabled: {\n      type: Boolean,\n      default: false\n    },\n\n    // Chunk upload properties\n    chunk: {\n      type: Object,\n      default: () => {\n        return CHUNK_DEFAULT_OPTIONS\n      }\n    }\n  },\n\n  data() {\n    return {\n      files: this.value,\n      features: {\n        html5: true,\n        directory: false,\n        drag: false,\n      },\n\n      active: false,\n      dropActive: false,\n\n      uploading: 0,\n\n      destroy: false,\n    }\n  },\n\n\n  /**\n   * mounted\n   * @return {[type]} [description]\n   */\n  mounted() {\n    let input = document.createElement('input')\n    input.type = 'file'\n    input.multiple = true\n\n    // html5 特征\n    if (window.FormData && input.files) {\n      // 上传目录特征\n      if (typeof input.webkitdirectory === 'boolean' || typeof input.directory === 'boolean') {\n        this.features.directory = true\n      }\n\n      // 拖拽特征\n      if (this.features.html5 && typeof input.ondrop !== 'undefined') {\n        this.features.drop = true\n      }\n    } else {\n      this.features.html5 = false\n    }\n\n    // files 定位缓存\n    this.maps = {}\n    if (this.files) {\n      for (let i = 0; i < this.files.length; i++) {\n        let file = this.files[i]\n        this.maps[file.id] = file\n      }\n    }\n\n    this.$nextTick(function () {\n\n      // 更新下父级\n      if (this.$parent) {\n        this.$parent.$forceUpdate()\n      }\n\n      // 拖拽渲染\n      this.watchDrop(this.drop)\n    })\n  },\n\n  /**\n   * beforeDestroy\n   * @return {[type]} [description]\n   */\n  beforeDestroy() {\n    // 已销毁\n    this.destroy = true\n\n    // 设置成不激活\n    this.active = false\n  },\n\n  computed: {\n    /**\n     * uploading 正在上传的线程\n     * @return {[type]} [description]\n     */\n\n    /**\n     * uploaded 文件列表是否全部已上传\n     * @return {[type]} [description]\n     */\n    uploaded() {\n      let file\n      for (let i = 0; i < this.files.length; i++) {\n        file = this.files[i]\n        if (file.fileObject && !file.error && !file.success) {\n          return false\n        }\n      }\n      return true\n    },\n\n    chunkOptions () {\n      return Object.assign(CHUNK_DEFAULT_OPTIONS, this.chunk)\n    },\n\n    className() {\n      return [\n        'file-uploads',\n        this.features.html5 ? 'file-uploads-html5' : 'file-uploads-html4',\n        this.features.directory && this.directory ? 'file-uploads-directory' : undefined,\n        this.features.drop && this.drop ? 'file-uploads-drop' : undefined,\n        this.disabled ? 'file-uploads-disabled' : undefined,\n      ]\n    }\n  },\n\n\n  watch: {\n    active(active) {\n      this.watchActive(active)\n    },\n\n    dropActive() {\n      if (this.$parent) {\n        this.$parent.$forceUpdate()\n      }\n    },\n\n    drop(value) {\n      this.watchDrop(value)\n    },\n\n    value(files) {\n      if (this.files === files) {\n        return\n      }\n      this.files = files\n\n      let oldMaps = this.maps\n\n      // 重写 maps 缓存\n      this.maps = {}\n      for (let i = 0; i < this.files.length; i++) {\n        let file = this.files[i]\n        this.maps[file.id] = file\n      }\n\n      // add, update\n      for (let key in this.maps) {\n        let newFile = this.maps[key]\n        let oldFile = oldMaps[key]\n        if (newFile !== oldFile) {\n          this.emitFile(newFile, oldFile)\n        }\n      }\n\n      // delete\n      for (let key in oldMaps) {\n        if (!this.maps[key]) {\n          this.emitFile(undefined, oldMaps[key])\n        }\n      }\n    },\n  },\n\n  methods: {\n\n    // 清空\n    clear() {\n      if (this.files.length) {\n        let files = this.files\n        this.files = []\n\n        // 定位\n        this.maps = {}\n\n        // 事件\n        this.emitInput()\n        for (let i = 0; i < files.length; i++) {\n          this.emitFile(undefined, files[i])\n        }\n      }\n      return true\n    },\n\n    // 选择\n    get(id) {\n      if (!id) {\n        return false\n      }\n\n      if (typeof id === 'object') {\n        return this.maps[id.id] || false\n      }\n\n      return this.maps[id] || false\n    },\n\n    // 添加\n    add(_files, index = this.addIndex) {\n      let files = _files\n      let isArray = files instanceof Array\n\n      // 不是数组整理成数组\n      if (!isArray) {\n        files = [files]\n      }\n\n      // 遍历规范对象\n      let addFiles = []\n      for (let i = 0; i < files.length; i++) {\n        let file = files[i]\n        if (this.features.html5 && file instanceof Blob) {\n          file = {\n            file,\n            size: file.size,\n            name: file.webkitRelativePath || file.relativePath || file.name || 'unknown',\n            type: file.type,\n          }\n        }\n        let fileObject = false\n        if (file.fileObject === false) {\n          // false\n        } else if (file.fileObject) {\n          fileObject = true\n        } else if (typeof Element !== 'undefined' && file.el instanceof Element) {\n          fileObject = true\n        } else if (typeof Blob !== 'undefined' && file.file instanceof Blob) {\n          fileObject = true\n        }\n        if (fileObject) {\n          file = {\n            fileObject: true,\n            size: -1,\n            name: 'Filename',\n            type: '',\n            active: false,\n            error: '',\n            success: false,\n            putAction: this.putAction,\n            postAction: this.postAction,\n            timeout: this.timeout,\n            ...file,\n            response: {},\n\n            progress: '0.00',          // 只读\n            speed: 0,                  // 只读\n            // xhr: false,                // 只读\n            // iframe: false,             // 只读\n          }\n\n          file.data = {\n            ...this.data,\n            ...file.data ? file.data : {},\n          }\n\n          file.headers = {\n            ...this.headers,\n            ...file.headers ? file.headers : {},\n          }\n        }\n\n        // 必须包含 id\n        if (!file.id) {\n          file.id = Math.random().toString(36).substr(2)\n        }\n\n        if (this.emitFilter(file, undefined)) {\n          continue\n        }\n\n        // 最大数量限制\n        if (this.maximum > 1 && (addFiles.length + this.files.length) >= this.maximum) {\n          break\n        }\n\n        addFiles.push(file)\n\n        // 最大数量限制\n        if (this.maximum === 1) {\n          break\n        }\n      }\n\n      // 没有文件\n      if (!addFiles.length) {\n        return false\n      }\n\n      // 如果是 1 清空\n      if (this.maximum === 1) {\n        this.clear()\n      }\n\n\n      // 添加进去 files\n      let newFiles\n      if (index === true || index === 0) {\n        newFiles = addFiles.concat(this.files)\n      } else if (index) {\n        newFiles = this.files.concat([])\n        newFiles.splice(index, 0, ...addFiles)\n      } else {\n        newFiles = this.files.concat(addFiles)\n      }\n\n      this.files = newFiles\n\n      // 定位\n      for (let i = 0; i < addFiles.length; i++) {\n        let file = addFiles[i]\n        this.maps[file.id] = file\n      }\n\n      // 事件\n      this.emitInput()\n      for (let i = 0; i < addFiles.length; i++) {\n        this.emitFile(addFiles[i], undefined)\n      }\n\n      return isArray ? addFiles : addFiles[0]\n    },\n\n\n\n    // 添加表单文件\n    addInputFile(el) {\n      let files = []\n      if (el.files) {\n        for (let i = 0; i < el.files.length; i++) {\n          let file = el.files[i]\n          files.push({\n            size: file.size,\n            name: file.webkitRelativePath || file.relativePath || file.name,\n            type: file.type,\n            file,\n          })\n        }\n      } else {\n        var names = el.value.replace(/\\\\/g, '/').split('/')\n        delete el.__vuex__\n        files.push({\n          name: names[names.length - 1],\n          el,\n        })\n      }\n      return this.add(files)\n    },\n\n\n    // 添加 DataTransfer\n    addDataTransfer(dataTransfer) {\n      let files = []\n      if (dataTransfer.items && dataTransfer.items.length) {\n        let items = []\n        for (let i = 0; i < dataTransfer.items.length; i++) {\n          let item = dataTransfer.items[i]\n          if (item.getAsEntry) {\n            item = item.getAsEntry() || item.getAsFile()\n          } else if (item.webkitGetAsEntry) {\n            item = item.webkitGetAsEntry() || item.getAsFile()\n          } else {\n            item = item.getAsFile()\n          }\n          if (item) {\n            items.push(item)\n          }\n        }\n\n        return new Promise((resolve, reject) => {\n          let forEach = (i) => {\n            let item = items[i]\n            // 结束 文件数量大于 最大数量\n            if (!item || (this.maximum > 0 && files.length >= this.maximum)) {\n              return resolve(this.add(files))\n            }\n            this.getEntry(item).then(function (results) {\n              files.push(...results)\n              forEach(i + 1)\n            })\n          }\n          forEach(0)\n        })\n      }\n\n      if (dataTransfer.files.length) {\n        for (let i = 0; i < dataTransfer.files.length; i++) {\n          files.push(dataTransfer.files[i])\n          if (this.maximum > 0 && files.length >= this.maximum) {\n            break\n          }\n        }\n        return Promise.resolve(this.add(files))\n      }\n\n      return Promise.resolve([])\n    },\n\n\n    // 获得 entry\n    getEntry(entry, path = '') {\n      return new Promise((resolve, reject) => {\n        if (entry.isFile) {\n          entry.file(function (file) {\n            resolve([\n              {\n                size: file.size,\n                name: path + file.name,\n                type: file.type,\n                file,\n              }\n            ])\n          })\n        } else if (entry.isDirectory && this.dropDirectory) {\n          let files = []\n          let dirReader = entry.createReader()\n          let readEntries = () => {\n            dirReader.readEntries((entries) => {\n              let forEach = (i) => {\n                if ((!entries[i] && i === 0) || (this.maximum > 0 && files.length >= this.maximum)) {\n                  return resolve(files)\n                }\n                if (!entries[i]) {\n                  return readEntries()\n                }\n                this.getEntry(entries[i], path + entry.name + '/').then((results) => {\n                  files.push(...results)\n                  forEach(i + 1)\n                })\n              }\n              forEach(0)\n            })\n          }\n          readEntries()\n        } else {\n          resolve([])\n        }\n      })\n    },\n\n\n    replace(id1, id2) {\n      let file1 = this.get(id1)\n      let file2 = this.get(id2)\n      if (!file1 || !file2 || file1 === file2) {\n        return false\n      }\n      let files = this.files.concat([])\n      let index1 = files.indexOf(file1)\n      let index2 = files.indexOf(file2)\n      if (index1 === -1 || index2 === -1) {\n        return false\n      }\n      files[index1] = file2\n      files[index2] = file1\n      this.files = files\n      this.emitInput()\n      return true\n    },\n\n    // 移除\n    remove(id) {\n      let file = this.get(id)\n      if (file) {\n        if (this.emitFilter(undefined, file)) {\n          return false\n        }\n        let files = this.files.concat([])\n        let index = files.indexOf(file)\n        if (index === -1) {\n          console.error('remove', file)\n          return false\n        }\n        files.splice(index, 1)\n        this.files = files\n\n        // 定位\n        delete this.maps[file.id]\n\n        // 事件\n        this.emitInput()\n        this.emitFile(undefined, file)\n      }\n      return file\n    },\n\n    // 更新\n    update(id, data) {\n      let file = this.get(id)\n      if (file) {\n        let newFile = {\n          ...file,\n          ...data\n        }\n        // 停用必须加上错误\n        if (file.fileObject && file.active && !newFile.active && !newFile.error && !newFile.success) {\n          newFile.error = 'abort'\n        }\n\n        if (this.emitFilter(newFile, file)) {\n          return false\n        }\n\n        let files = this.files.concat([])\n        let index = files.indexOf(file)\n        if (index === -1) {\n          console.error('update', file)\n          return false\n        }\n        files.splice(index, 1, newFile)\n        this.files = files\n\n        // 删除  旧定位 写入 新定位 （已便支持修改id)\n        delete this.maps[file.id]\n        this.maps[newFile.id] = newFile\n\n        // 事件\n        this.emitInput()\n        this.emitFile(newFile, file)\n        return newFile\n      }\n      return false\n    },\n\n\n\n    // 预处理 事件 过滤器\n    emitFilter(newFile, oldFile) {\n      let isPrevent = false\n      this.$emit('input-filter', newFile, oldFile, function () {\n        isPrevent = true\n        return isPrevent\n      })\n      return isPrevent\n    },\n\n    // 处理后 事件 分发\n    emitFile(newFile, oldFile) {\n      this.$emit('input-file', newFile, oldFile)\n      if (newFile && newFile.fileObject && newFile.active && (!oldFile || !oldFile.active)) {\n        this.uploading++\n        // 激活\n        this.$nextTick(function () {\n          setTimeout(() => {\n            this.upload(newFile).then(() => {\n              // eslint-disable-next-line\n              newFile = this.get(newFile)\n              if (newFile && newFile.fileObject) {\n                this.update(newFile, {\n                  active: false,\n                  success: !newFile.error\n                })\n              }\n            }).catch((e) => {\n              this.update(newFile, {\n                active: false,\n                success: false,\n                error: e.code || e.error || e.message || e\n              })\n            })\n          }, parseInt(Math.random() * 50 + 50, 10))\n        })\n      } else if ((!newFile || !newFile.fileObject || !newFile.active) && oldFile && oldFile.fileObject && oldFile.active) {\n        // 停止\n        this.uploading--\n      }\n\n      // 自动延续激活\n      if (this.active && (Boolean(newFile) !== Boolean(oldFile) || newFile.active !== oldFile.active)) {\n        this.watchActive(true)\n      }\n    },\n\n    emitInput() {\n      this.$emit('input', this.files)\n    },\n\n\n    // 上传\n    upload(id) {\n      let file = this.get(id)\n\n      // 被删除\n      if (!file) {\n        return Promise.reject('not_exists')\n      }\n\n      // 不是文件对象\n      if (!file.fileObject) {\n        return Promise.reject('file_object')\n      }\n\n      // 有错误直接响应\n      if (file.error) {\n        return Promise.reject(file.error)\n      }\n\n      // 已完成直接响应\n      if (file.success) {\n        return Promise.resolve(file)\n      }\n\n      // 后缀\n      let extensions = this.extensions\n      if (extensions && (extensions.length || typeof extensions.length === 'undefined')) {\n        if (typeof extensions !== 'object' || !(extensions instanceof RegExp)) {\n          if (typeof extensions === 'string') {\n            extensions = extensions.split(',').map(value => value.trim()).filter(value => value)\n          }\n          extensions = new RegExp('\\\\.(' + extensions.join('|').replace(/\\./g, '\\\\.') + ')$', 'i')\n        }\n        if (file.name.search(extensions) === -1) {\n          return Promise.reject('extension')\n        }\n      }\n\n      // 大小\n      let size = (typeof this.size === 'function' ? this.size(file) : this.size)\n\n      if (size > 0 && file.size >= 0 && file.size > size) {\n        return Promise.reject('size')\n      }\n\n      if (this.customAction) {\n        return this.customAction(file, this)\n      }\n\n      if (this.features.html5) {\n        if (this.shouldUseChunkUpload(file)) {\n          return this.uploadChunk(file)\n        }\n        if (file.putAction) {\n          return this.uploadPut(file)\n        }\n        if (file.postAction) {\n          return this.uploadHtml5(file)\n        }\n      }\n      if (file.postAction) {\n        return this.uploadHtml4(file)\n      }\n      return Promise.reject('No action configured')\n    },\n\n    /**\n     * Whether this file should be uploaded using chunk upload or not\n     *\n     * @param Object file\n     */\n    shouldUseChunkUpload (file) {\n      return this.chunkEnabled &&\n        !!this.chunkOptions.handler &&\n        file.size > this.chunkOptions.minSize\n    },\n\n    /**\n     * Upload a file using Chunk method\n     *\n     * @param File file\n     */\n    uploadChunk (file) {\n      const HandlerClass = this.chunkOptions.handler\n      file.chunk = new HandlerClass(file, this.chunkOptions)\n\n      return file.chunk.upload()\n    },\n\n    uploadPut(file) {\n      let querys = []\n      let value\n      for (let key in file.data) {\n        value = file.data[key]\n        if (value !== null && value !== undefined) {\n          querys.push(encodeURIComponent(key) + '=' + encodeURIComponent(value))\n        }\n      }\n      let queryString = querys.length ? (file.putAction.indexOf('?') === -1 ? '?' : '&') + querys.join('&') : ''\n      let xhr = new XMLHttpRequest()\n      xhr.open('PUT', file.putAction + queryString)\n      return this.uploadXhr(xhr, file, file.file)\n    },\n\n    uploadHtml5(file) {\n      let form = new window.FormData()\n      let value\n      for (let key in file.data) {\n        value = file.data[key]\n        if (value && typeof value === 'object' && typeof value.toString !== 'function') {\n          if (value instanceof File) {\n            form.append(key, value, value.name)\n          } else {\n            form.append(key, JSON.stringify(value))\n          }\n        } else if (value !== null && value !== undefined) {\n          form.append(key, value)\n        }\n      }\n      form.append(this.name, file.file, file.file.filename || file.name)\n      let xhr = new XMLHttpRequest()\n      xhr.open('POST', file.postAction)\n      return this.uploadXhr(xhr, file, form)\n    },\n\n    uploadXhr(xhr, _file, body) {\n      let file = _file\n      let speedTime = 0\n      let speedLoaded = 0\n\n      // 进度条\n      xhr.upload.onprogress = (e) => {\n        // 还未开始上传 已删除 未激活\n        file = this.get(file)\n        if (!e.lengthComputable || !file || !file.fileObject || !file.active) {\n          return\n        }\n\n        // 进度 速度 每秒更新一次\n        let speedTime2 = Math.round(Date.now() / 1000)\n        if (speedTime2 === speedTime) {\n          return\n        }\n        speedTime = speedTime2\n\n        file = this.update(file, {\n          progress: (e.loaded / e.total * 100).toFixed(2),\n          speed: e.loaded - speedLoaded,\n        })\n        speedLoaded = e.loaded\n      }\n\n      // 检查激活状态\n      let interval = setInterval(() => {\n        file = this.get(file)\n        if (file && file.fileObject && !file.success && !file.error && file.active) {\n          return\n        }\n\n        if (interval) {\n          clearInterval(interval)\n          interval = false\n        }\n\n        try {\n          xhr.abort()\n          xhr.timeout = 1\n        } catch (e) {\n        }\n      }, 100)\n\n      return new Promise((resolve, reject) => {\n        let complete\n        let fn = (e) => {\n          // 已经处理过了\n          if (complete) {\n            return\n          }\n          complete = true\n          if (interval) {\n            clearInterval(interval)\n            interval = false\n          }\n\n          file = this.get(file)\n\n          // 不存在直接响应\n          if (!file) {\n            return reject('not_exists')\n          }\n\n          // 不是文件对象\n          if (!file.fileObject) {\n            return reject('file_object')\n          }\n\n          // 有错误自动响应\n          if (file.error) {\n            return reject(file.error)\n          }\n\n          // 未激活\n          if (!file.active) {\n            return reject('abort')\n          }\n\n\n          // 已完成 直接相应\n          if (file.success) {\n            return resolve(file)\n          }\n\n          let data = {}\n\n          switch (e.type) {\n            case 'timeout':\n            case 'abort':\n              data.error = e.type\n              break\n            case 'error':\n              if (!xhr.status) {\n                data.error = 'network'\n              } else if (xhr.status >= 500) {\n                data.error = 'server'\n              } else if (xhr.status >= 400) {\n                data.error = 'denied'\n              }\n              break\n            default:\n              if (xhr.status >= 500) {\n                data.error = 'server'\n              } else if (xhr.status >= 400) {\n                data.error = 'denied'\n              } else {\n                data.progress = '100.00'\n              }\n          }\n\n          if (xhr.responseText) {\n            let contentType = xhr.getResponseHeader('Content-Type')\n            if (contentType && contentType.indexOf('/json') !== -1) {\n              data.response = JSON.parse(xhr.responseText)\n            } else {\n              data.response = xhr.responseText\n            }\n          }\n\n          // 更新\n          file = this.update(file, data)\n\n          // 相应错误\n          if (file.error) {\n            return reject(file.error)\n          }\n\n          // 响应\n          return resolve(file)\n        }\n\n        // 事件\n        xhr.onload = fn\n        xhr.onerror = fn\n        xhr.onabort = fn\n        xhr.ontimeout = fn\n\n        // 超时\n        if (file.timeout) {\n          xhr.timeout = file.timeout\n        }\n\n        // headers\n        for (let key in file.headers) {\n          xhr.setRequestHeader(key, file.headers[key])\n        }\n\n        // 更新 xhr\n        file = this.update(file, { xhr })\n\n        // 开始上传\n        xhr.send(body)\n      })\n    },\n\n\n\n\n    uploadHtml4(_file) {\n      let file = _file\n      let onKeydown = function (e) {\n        if (e.keyCode === 27) {\n          e.preventDefault()\n        }\n      }\n\n      let iframe = document.createElement('iframe')\n      iframe.id = 'upload-iframe-' + file.id\n      iframe.name = 'upload-iframe-' + file.id\n      iframe.src = 'about:blank'\n      iframe.setAttribute('style', 'width:1px;height:1px;top:-999em;position:absolute; margin-top:-999em;')\n\n\n      let form = document.createElement('form')\n\n      form.action = file.postAction\n\n      form.name = 'upload-form-' + file.id\n\n\n      form.setAttribute('method', 'POST')\n      form.setAttribute('target', 'upload-iframe-' + file.id)\n      form.setAttribute('enctype', 'multipart/form-data')\n\n      let value\n      let input\n      for (let key in file.data) {\n        value = file.data[key]\n        if (value && typeof value === 'object' && typeof value.toString !== 'function') {\n          value = JSON.stringify(value)\n        }\n        if (value !== null && value !== undefined) {\n          input = document.createElement('input')\n          input.type = 'hidden'\n          input.name = key\n          input.value = value\n          form.appendChild(input)\n        }\n      }\n      form.appendChild(file.el)\n\n      document.body.appendChild(iframe).appendChild(form)\n\n\n\n\n      let getResponseData = function () {\n        let doc\n        try {\n          if (iframe.contentWindow) {\n            doc = iframe.contentWindow.document\n          }\n        } catch (err) {\n        }\n        if (!doc) {\n          try {\n            doc = iframe.contentDocument ? iframe.contentDocument : iframe.document\n          } catch (err) {\n            doc = iframe.document\n          }\n        }\n        if (doc && doc.body) {\n          return doc.body.innerHTML\n        }\n        return null\n      }\n\n\n      return new Promise((resolve, reject) => {\n        setTimeout(() => {\n          file = this.update(file, { iframe })\n\n          // 不存在\n          if (!file) {\n            return reject('not_exists')\n          }\n\n          // 定时检查\n          let interval = setInterval(() => {\n            file = this.get(file)\n            if (file && file.fileObject && !file.success && !file.error && file.active) {\n              return\n            }\n\n            if (interval) {\n              clearInterval(interval)\n              interval = false\n            }\n\n            iframe.onabort({ type: file ? 'abort' : 'not_exists' })\n          }, 100)\n\n\n          let complete\n          let fn = (e) => {\n            // 已经处理过了\n            if (complete) {\n              return\n            }\n            complete = true\n\n\n            if (interval) {\n              clearInterval(interval)\n              interval = false\n            }\n\n            // 关闭 esc 事件\n            document.body.removeEventListener('keydown', onKeydown)\n\n            file = this.get(file)\n\n            // 不存在直接响应\n            if (!file) {\n              return reject('not_exists')\n            }\n\n            // 不是文件对象\n            if (!file.fileObject) {\n              return reject('file_object')\n            }\n\n            // 有错误自动响应\n            if (file.error) {\n              return reject(file.error)\n            }\n\n            // 未激活\n            if (!file.active) {\n              return reject('abort')\n            }\n\n            // 已完成 直接相应\n            if (file.success) {\n              return resolve(file)\n            }\n\n            let response = getResponseData()\n            let data = {}\n            switch (e.type) {\n              case 'abort':\n                data.error = 'abort'\n                break\n              case 'error':\n                if (file.error) {\n                  data.error = file.error\n                } else if (response === null) {\n                  data.error = 'network'\n                } else {\n                  data.error = 'denied'\n                }\n                break\n              default:\n                if (file.error) {\n                  data.error = file.error\n                } else if (data === null) {\n                  data.error = 'network'\n                } else {\n                  data.progress = '100.00'\n                }\n            }\n\n            if (response !== null) {\n              if (response && response.substr(0, 1) === '{' && response.substr(response.length - 1, 1) === '}') {\n                try {\n                  response = JSON.parse(response)\n                } catch (err) {\n                }\n              }\n              data.response = response\n            }\n\n            // 更新\n            file = this.update(file, data)\n\n            if (file.error) {\n              return reject(file.error)\n            }\n\n            // 响应\n            return resolve(file)\n          }\n\n\n          // 添加事件\n          iframe.onload = fn\n          iframe.onerror = fn\n          iframe.onabort = fn\n\n\n          // 禁止 esc 键\n          document.body.addEventListener('keydown', onKeydown)\n\n          // 提交\n          form.submit()\n        }, 50)\n      }).then(function (res) {\n        iframe.parentNode && iframe.parentNode.removeChild(iframe)\n        return res\n      }).catch(function (res) {\n        iframe.parentNode && iframe.parentNode.removeChild(iframe)\n        return res\n      })\n    },\n\n\n\n    watchActive(active) {\n      let file\n      let index = 0\n      while ((file = this.files[index])) {\n        index++\n        if (!file.fileObject) {\n          // 不是文件对象\n        } else if (active && !this.destroy) {\n          if (this.uploading >= this.thread || (this.uploading && !this.features.html5)) {\n            break\n          }\n          if (!file.active && !file.error && !file.success) {\n            this.update(file, { active: true })\n          }\n        } else {\n          if (file.active) {\n            this.update(file, { active: false })\n          }\n        }\n      }\n      if (this.uploading === 0) {\n        this.active = false\n      }\n    },\n\n\n    watchDrop(_el) {\n      let el = _el\n      if (!this.features.drop) {\n        return\n      }\n\n      // 移除挂载\n      if (this.dropElement) {\n        try {\n          document.removeEventListener('dragenter', this.onDragenter, false)\n          document.removeEventListener('dragleave', this.onDragleave, false)\n          document.removeEventListener('drop', this.onDocumentDrop, false)\n          this.dropElement.removeEventListener('dragover', this.onDragover, false)\n          this.dropElement.removeEventListener('drop', this.onDrop, false)\n        } catch (e) {\n        }\n      }\n\n      if (!el) {\n        el = false\n      } else if (typeof el === 'string') {\n        el = document.querySelector(el) || this.$root.$el.querySelector(el)\n      } else if (el === true) {\n        el = this.$parent.$el\n      }\n\n      this.dropElement = el\n\n      if (this.dropElement) {\n        document.addEventListener('dragenter', this.onDragenter, false)\n        document.addEventListener('dragleave', this.onDragleave, false)\n        document.addEventListener('drop', this.onDocumentDrop, false)\n        this.dropElement.addEventListener('dragover', this.onDragover, false)\n        this.dropElement.addEventListener('drop', this.onDrop, false)\n      }\n    },\n\n\n    onDragenter(e) {\n      e.preventDefault()\n      if (this.dropActive) {\n        return\n      }\n      if (!e.dataTransfer) {\n        return\n      }\n      let dt = e.dataTransfer\n      if (dt.files && dt.files.length) {\n        this.dropActive = true\n      } else if (!dt.types) {\n        this.dropActive = true\n      } else if (dt.types.indexOf && dt.types.indexOf('Files') !== -1) {\n        this.dropActive = true\n      } else if (dt.types.contains && dt.types.contains('Files')) {\n        this.dropActive = true\n      }\n    },\n\n    onDragleave(e) {\n      e.preventDefault()\n      if (!this.dropActive) {\n        return\n      }\n      if (e.target.nodeName === 'HTML' || e.target === e.explicitOriginalTarget || (!e.fromElement && (e.clientX <= 0 || e.clientY <= 0 || e.clientX >= window.innerWidth || e.clientY >= window.innerHeight))) {\n        this.dropActive = false\n      }\n    },\n\n    onDragover(e) {\n      e.preventDefault()\n    },\n\n    onDocumentDrop() {\n      this.dropActive = false\n    },\n\n    onDrop(e) {\n      e.preventDefault()\n      this.addDataTransfer(e.dataTransfer)\n    },\n  }\n}\n","module.exports = require('./FileUpload.vue')\n"],"names":["createRequest","options","xhr","XMLHttpRequest","open","method","url","responseType","headers","Object","keys","forEach","setRequestHeader","key","sendRequest","body","Promise","resolve","reject","onload","status","response","JSON","parse","err","onerror","send","stringify","sendFormRequest","data","FormData","name","append","ChunkUploadHandler","file","chunks","start","end","chunkSize","fileSize","push","blob","slice","startOffset","active","retries","maxRetries","progress","stopChunks","chunksUploading","chunk","abort","startChunking","promise","request","assign","action","startBody","phase","mime_type","fileType","size","fileName","then","res","sessionId","session_id","end_offset","createChunks","catch","i","maxActiveChunks","uploadNextChunk","hasChunksToUpload","uploadChunk","chunksToUpload","length","finish","updateFileProgress","upload","addEventListener","evt","lengthComputable","Math","round","loaded","total","uploadBody","start_offset","uploaded","finishBody","parseInt","maxActive","type","completedProgress","chunksUploaded","uploadingProgress","reduce","min","filter","methods","change","e","$parent","addInputFile","target","files","value","test","navigator","userAgent","$destroy","constructor","parent","el","$el","CHUNK_DEFAULT_OPTIONS","minSize","handler","ChunkUploadDefaultHandler","components","InputFile","props","inputId","String","default","accept","capture","disabled","multiple","Boolean","maximum","Number","addIndex","directory","postAction","putAction","customAction","Function","timeout","drop","dropDirectory","extensions","Array","thread","chunkEnabled","features","html5","drag","dropActive","uploading","destroy","mounted","input","document","createElement","window","webkitdirectory","ondrop","maps","id","$nextTick","$forceUpdate","watchDrop","beforeDestroy","computed","fileObject","error","success","chunkOptions","className","undefined","watch","watchActive","oldMaps","newFile","oldFile","emitFile","clear","emitInput","get","add","_files","index","isArray","addFiles","Blob","webkitRelativePath","relativePath","Element","speed","random","toString","substr","emitFilter","newFiles","concat","splice","names","replace","split","__vuex__","addDataTransfer","dataTransfer","items","item","getAsEntry","getAsFile","webkitGetAsEntry","getEntry","results","entry","path","isFile","isDirectory","dirReader","createReader","readEntries","entries","id1","id2","file1","file2","index1","indexOf","index2","remove","console","update","isPrevent","$emit","setTimeout","code","message","RegExp","map","trim","join","search","shouldUseChunkUpload","uploadPut","uploadHtml5","uploadHtml4","HandlerClass","querys","encodeURIComponent","queryString","uploadXhr","form","File","filename","_file","speedTime","speedLoaded","onprogress","speedTime2","Date","now","toFixed","interval","setInterval","clearInterval","complete","fn","responseText","contentType","getResponseHeader","onabort","ontimeout","onKeydown","keyCode","preventDefault","iframe","src","setAttribute","appendChild","getResponseData","doc","contentWindow","contentDocument","innerHTML","removeEventListener","submit","parentNode","removeChild","_el","dropElement","onDragenter","onDragleave","onDocumentDrop","onDragover","onDrop","querySelector","$root","dt","types","contains","nodeName","explicitOriginalTarget","fromElement","clientX","clientY","innerWidth","innerHeight","require$$0"],"mappings":"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"}